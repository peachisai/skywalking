# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

version: "3"

services:
  datadog-demo:
    image: ghcr.io/open-telemetry/demo:1.4.0-frontend
    deploy:
      resources:
        limits:
          memory: 200M
    restart: unless-stopped
    ports:
      - 8070
    environment:
      PORT: 8070
      FRONTEND_ADDR: frontend:8080
      PRODUCT_CATALOG_SERVICE_ADDR: productcatalogservice:3550
      OTEL_EXPORTER_OTLP_ENDPOINT: http://oap:11800
      OTEL_RESOURCE_ATTRIBUTES: service.namespace=opentelemetry-demo
      ENV_PLATFORM: local
      OTEL_SERVICE_NAME: frontend
      WEB_OTEL_SERVICE_NAME: frontend-web
      CURRENCY_SERVICE_ADDR: no.exist:80
    depends_on:
      - oap
      - productcatalogservice
    logging: *logging
    networks:
      - e2e

  oap:
    extends:
      file: ../../script/docker-compose/base-compose.yml
      service: oap
    ports:
      - 12800
      - 8126
    environment:
      SW_RECEIVER_DATADOG: default

networks:
  e2e:
